- 在软件开发中，散布于应用中多处的功能被称为横切关注点。通常来讲，这些横切关注点从概念上是与应用的业务逻辑相分离的。
- 把这些横切关注点与业务逻辑相分离正是面向切面编程(AOP)所要解决的问题。
>
- DI有助于应用对象之间的解耦，AOP可以实现横切关注点与它们所影响的对象之间的解耦。
>
- 事务、日志、缓存、安全等
>
### 什么是面向切面编程？
>
- ![](https://github.com/lu666666/notebooks/blob/master/java/spring/sping_in_action/04/pic/01.png)
>
- 如图，每个模块的核心功能都是为特定业务领域提供服务，但是这些模块都需要类似的辅助功能，例如安全和事务管理。
>
- 如果要重用通用功能的话，最常见的面向对象技术是继承或委托。但是，
- 如果在整个应用中都使用相同的基类，继承往往会导致一个脆弱的对象体系；而使用委托可能需要对委托对象进行复杂的调用。
>
- 切面提供了取代继承和委托的另一种可选方案，而且在很多场景下更清晰简洁。
- 在使用面向切面编程时，我们仍然在一个地方定义通用功能类，但是可以通过声明的方式定义这个功能以何种方式在何处应用，而无须修改受影响的类。
>
- 横切关注点可以被模块化为特殊的类，这些类被称为切面。这样做有两个好处：
- 首先，现在每个关注点都集中于一个地方，而不是分散到多处代码中；
- 其次，服务模块更简洁，因为它们只包含主要关注点（或核心功能）的代码，而次要关注点的代码被转移到切面中了。
>
### 定义AOP术语
>
- 描述切面的常用术语有通知（active）、切点（pointcut）、和连接点（join point）。
>
![](https://github.com/lu666666/notebooks/blob/master/java/spring/sping_in_action/04/pic/02.png)
>
### 通知active
>
- 切面的目标：它必须要完成的工作。AOP中，切面的工作被称为通知。
>
- Spring切面可以应用5种类型的通知：
>
- 前置通知（Before）
- 后置通知（After）
- 返回通知（After-returning）
- 异常通知（After-throwing）
- 环绕通知（Around）
>
### 连接点join point
>
- 连接点是在应用执行过程中能够插入切面的一个点。这个点可以是调用方法时、抛出异常时、甚至修改一个字段时。
- 切面代码可以利用这些点插入到应用的正常流程之中，并添加新的行为。
>
### 切点 pointcut
>
- 一个切面并不需要通知应用的所有连接点。切点有助于缩小切面所通知的连接点的范围。
>
- 通知定义了切面的“什么”和“何时”，切点定义了“何处”。
- 切点的定义会匹配所要织入的一个或多个连接点。
>
### 切面 Aspect
>
- 切面是通知和切点的结合。通知和切点共同定义了切面的全部内容：它是什么，在何时和何处完成其功能。
>
### 引入 Introduction
>
- 引入允许我们向现有的类添加新方法或属性。无需修改现有的类，让它们具有新的行为和状态。
>
### 织入 Weaving
>
- 织入是把切面应用到目标对象并创建新的代理对象的过程。切面在指定的连接点被织入到目标对象中。在目标对象的生命周期里有多个点可以进行织入：
>
- 编译期：切面在目标类编译时被织入。需要特殊的编译器，
- 类加载期：在目标类加载到JVM时被织入，需要特殊的类加载器，可以在目标类被引入应用之前增强该目标类的字节码。
- 运行期：在应用运行的某个时刻被织入，AOP容器会为目标对象动态地创建一个代理对象。Spring AOP
>
- 通知包含了需要用于多个应用对象的横切行为；
- 连接点是程序执行过程中能够应用通知的所有点；
- 切点定义了通知被应用的具体位置；切点定义了哪些连接点会得到通知。
>
### Spring 对 AOP 的支持
>
- 并不是所有的AOP框架都是相同的，它们在连接点模型上可能有强弱之分。
- 有些允许在字段修饰符级别应用通知，而另一些只支持与方法调用相关的连接点。它们织入切面的方式和时机也不同。
- 无论如何，**创建切点来定义切面所织入的连接点**是AOP框架的基本功能。
>
- Spring对AOP的支持在很多方面借鉴了AspectJ项目。
>
- Spring提供了4种类型的AOP支持：
>
- 基于代理的经典Spring AOP
- 纯POJO切面
- @AspectJ注解驱动的切面
- 注入式AspectJ切面（适用于Spring各版本）
>
- 前三种都是Spring AOP实现的变体，Spring AOP构建在动态代理基础之上，因此，Spring 对 AOP 的支持仅限于方法拦截。
- 如果你的AOP需求超过了简单的方法调用，那么需要考虑使用AspectJ来实现切面。
>
#### Spring通知是Java编写的
>
- Spring所创建的通知都是用标准的Java类来编写的。这样的话，我们就可以使用与普通Java开发一样的集成开发环境来开发切面。
- 而且，定义通知所应用的切点通常会使用注解或在Spring配置文件里采用XML来编写，比较熟悉。
>
- AspectJ与之相反。通过特有的AOP语言，可以获得更强大和细粒度的控制，以及更丰富的AOP工具集，但是需要额外的学习成本。
>
#### Spring 在运行时通知对象。
>
- 通过在代理类中包裹切面，Spring在运行期把切面织入到Spring管理的bean中。如图
>
![](https://github.com/lu666666/notebooks/blob/master/java/spring/sping_in_action/04/pic/03.png)
>
- 代理类封装了目标类，并拦截被通知方法的调用，再把调用转发给真正的目标bean。当代理拦截到方法调用时，在调用目标bean方法之前，会执行切面逻辑。
>
- 知道应用需要被代理的bean时，Spring才会创建代理对象。
>
#### Spring 只支持方法级别的连接点
>
- 因为Spring基于动态代理，所以Spring只支持方法连接点。这与其他的AOP框架是不同的。
- 例如Aspect和JBoss，除了方法切点，它们还提供了字段和构造器接入点。
- Spring缺少对字段连接点的支持，无法让我们创建细粒度的通知，例如拦截对象字段的修改。而且不支持构造器连接点，无法在bean创建时应用通知。







